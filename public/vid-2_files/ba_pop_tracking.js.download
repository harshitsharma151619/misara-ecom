!function(){function t(t,e){var o=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);e&&(a=a.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),o.push.apply(o,a)}return o}function e(t,e,o){return e in t?Object.defineProperty(t,e,{value:o,enumerable:!0,configurable:!0,writable:!0}):t[e]=o,t}window.popMet=function(){var o=function(t,e,o,a){var n="",r="";if(o){var i=new Date;i.setTime(i.getTime()+60*o*1e3),n="; expires="+i.toGMTString()}a&&(r="; domain="+a),document.cookie=t+"="+escape(e)+n+r+"; path=/"},a={urlPrefix:"",visitsUrl:window.Pop.global_config.proxy_paths.app_metrics,baEvsUrl:window.Pop.global_config.proxy_paths.app_metrics,page:null,useBeacon:!1,startOnReady:!0,applyVisits:!0,cookies:!0,cookieDomain:null,headers:{},visitParams:{},withCredentials:!1,pv:window.Pop.global_config.pv,bam:window.Pop.global_config.bam,batc:window.Pop.global_config.batc},n=window.popMet||{};n.configure=function(t){for(var e in t)t.hasOwnProperty(e)&&(a[e]=t[e])},n.configure(n);var r=!1,i=[],s="undefined"!=typeof JSON&&void 0!==JSON.stringify,c=[];function u(){return a.urlPrefix+a.baEvsUrl}function l(){for(var t;t=i.shift();)t();r=!0}function g(t){r?t():i.push(t)}n.setCookie=function(t,e,n){o(t,e,n,a.cookieDomain||a.domain)},n.getCookie=function(t){return function(t){var e,o,a=t+"=",n=document.cookie.split(";");for(e=0;e<n.length;e++){for(o=n[e];" "===o.charAt(0);)o=o.substring(1,o.length);if(0===o.indexOf(a))return unescape(o.substring(a.length,o.length))}return null}(t)},n.destroyCookie=function(t){o(t,"",-1)},n.log=function(t){n.getCookie("baMet_debug")&&window.console.log(t)};const d=["a","div"];function p(t,e){let o=t;var a=o.matches||o.matchesSelector||o.mozMatchesSelector||o.msMatchesSelector||o.oMatchesSelector||o.webkitMatchesSelector;if(a){if(a.apply(o,[e]))return o;if(!d.includes(o.tagName.toLowerCase())){for(;!d.includes(o.tagName.toLowerCase());)o=o.parentElement;return p(o,[e])}return!1}return n.log("Unable to match"),!1}function m(t,e){var o=[];for(O=0;O<e.items.length;O++){var a=e.items[O];o.push({id:a.id,properties:a.properties,quantity:a.quantity,variant_id:a.variant_id,product_id:a.product_id,final_price:a.final_price,image:a.image,handle:a.handle,title:a.title})}return{token:t,total_price:e.total_price,items:o,currency:e.currency}}function f(t){t._url.indexOf("/cart/add")>=0?n.getCartData((function(t){n.log(t),n.setCartAttributes(!0,t)})):n.setCartAttributes(!0,t.response)}function v(){return"xxxxxxxxxxxx4xxxyxxxxxxxxxxxxxxx".replace(/[xy]/g,(function(t){var e=16*Math.random()|0;return("x"==t?e:3&e|8).toString(16)}))+Math.floor(Date.now()).toString()}function h(){a.cookies&&s&&n.setCookie("baMet_baEvs",JSON.stringify(c),1)}function b(o){var a=o;return a.common=function(o){for(var a=1;a<arguments.length;a++){var n=null!=arguments[a]?arguments[a]:{};a%2?t(Object(n),!0).forEach((function(t){e(o,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(n)):t(Object(n)).forEach((function(t){Object.defineProperty(o,t,Object.getOwnPropertyDescriptor(n,t))}))}return o}({},window.Pop.common),delete a.common.product,a.api={},a}function w(t){g((function(){n.sendRequest(u(),b(t),(function(){for(var e=0;e<c.length;e++)if(c[e].id==t.id){c.splice(e,1);break}h()}))}))}function _(t){var e,o;(a.useBeacon||a.applyNow)&&(o=a.headers,0===Object.keys(o).length)&&s&&void 0!==window.navigator.sendBeacon&&!a.withCredentials?(e=t,g((function(){var t,o=b(e),a=(t=document.querySelector("meta[name=csrf-param]"))&&t.content,n=function(){var t=document.querySelector("meta[name=csrf-token]");return t&&t.content}();a&&n&&(o[a]=n),window.navigator.sendBeacon(u(),JSON.stringify(o))}))):(c.push(t),h(),setTimeout((function(){w(t)}),1e3))}function y(){return window.location.pathname}function C(t){return t&&t.length>0?t:null}function S(t){var e=t.target;return function(t){for(var e in t)t.hasOwnProperty(e)&&null===t[e]&&delete t[e];return t}({tag:e.tagName.toLowerCase(),id:C(e.id),class:C(e.className),page:y()})}function k(){var t=new Date,e=t.toISOString().slice(0,10),o=n.getBrowserInfo(),r={shop_id:window.Pop.common.shop.id,name:"create_visit",params:{landing_page:window.location.href,screen_width:window.screen.width,screen_height:window.screen.height,browser:o.browser,os:o.os,timezone:o.timezone},timestamp:parseInt(t.getTime()),date:e,hour:t.getUTCHours(),id:v(),visit_token:n.getVisitId(),visitor_token:n.getVisitorId(),app:"ba"};for(var i in document.referrer.length>0&&(r.referrer=document.referrer),a.visitParams)a.visitParams.hasOwnProperty(i)&&(r[i]=a.visitParams[i]);n.log(r),a.bam||_(r)}function x(){var t=function(){var t=n.getVisitId(),e=n.getVisitorId()&&!t;n.log("current visit_token"),n.log(t);var o=new Date,a=new Date;a.setUTCHours(23,59,59,59);var r=(a-o)/1e3,i=r/60;return(i>30||r<2)&&(i=30),!t||r<2?(t=v(),n.setCookie("baMet_visit",t,i),e&&k()):n.setCookie("baMet_visit",t,i),t}(),e=n.getVisitorId();!1===a.cookies||!1===a.applyVisits?(n.log("Visit applying disabled"),l()):t&&e?(n.log("Active visit"),l()):n.getCookie("baMet_visit")?(n.log("Visit started"),e||(e=v(),localStorage.setItem("baMet_visitor",e)),k(),l()):(n.log("baCookies disabled"),l())}n.onBaEv=function(t,e,o){document.addEventListener(t,(function(t){const a=p(t.target,e);a&&o({target:a})}))},n.sendRequest=function(t,e,o){fetch(t,{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(e)}).then((function(t){console.log(t),o(t)})).catch((function(t){console.log(t)}))},n.getCartData=function(t){fetch("/cart.js?ba_request=1",{method:"GET",headers:{Accept:"application/json","Content-Type":"application/json"}}).then((function(e){200===e.status?e.json().then((function(e){t(e)})):console.log("Looks like there was a problem. Status Code: "+e.status)})).catch((function(t){console.log(t)}))},n.syncCsId=function(){var t=n.getCookie("baMet_cs_id");return t||(t=v()),n.setCookie("baMet_cs_id",t,20160),t},n.getVisitId=n.getVisitToken=function(){return n.getCookie("baMet_visit")},n.getVisitorId=n.getVisitorToken=function(){return localStorage.getItem("baMet_visitor")},n.getCustomerId=function(){return localStorage.getItem("baMet_customer_id")},n.isAdmin=function(){return n.getCookie("ba_admin")},n.reset=function(){return n.destroyCookie("baMet_visit"),localStorage.removeItem("baMet_visitor"),n.destroyCookie("baMet_baEvs"),n.destroyCookie("baMet_apply"),!0},n.debug=function(t){return!1===t?n.destroyCookie("baMet_debug"):n.setCookie("baMet_debug","t",525600),!0},n.getBrowserInfo=function(){var t={options:[],header:[navigator.platform,navigator.userAgent,navigator.appVersion,navigator.vendor,window.opera],dataos:[{name:"Windows Phone",value:"Windows Phone",version:"OS"},{name:"Windows",value:"Win",version:"NT"},{name:"iPhone",value:"iPhone",version:"OS"},{name:"iPad",value:"iPad",version:"OS"},{name:"Android",value:"Android",version:"Android"},{name:"Mac OS",value:"Mac",version:"OS X"},{name:"Linux",value:"Linux",version:"rv"},{name:"Palm",value:"Palm",version:"PalmOS"}],databrowser:[{name:"Chrome",value:"Chrome",version:"Chrome"},{name:"Firefox",value:"Firefox",version:"Firefox"},{name:"Safari",value:"Safari",version:"Version"},{name:"Internet Explorer",value:"MSIE",version:"MSIE"},{name:"Opera",value:"Opera",version:"Opera"},{name:"BlackBerry",value:"CLDC",version:"CLDC"},{name:"Mozilla",value:"Mozilla",version:"Mozilla"}],init:function(){var t=this.header.join(" "),e=this.matchItem(t,this.dataos),o=this.matchItem(t,this.databrowser),a=(new Date).getTimezoneOffset()/60;return timezone=Intl.DateTimeFormat().resolvedOptions().timeZone,{os:e,browser:o,tz_offset:a,timezone:timezone}},matchItem:function(t,e){var o,a,n=0,r=0;for(n=0;n<e.length;n+=1)if(new RegExp(e[n].value,"i").test(t)){if(o=new RegExp(e[n].version+"[- /:;]([\\d._]+)","i"),"",(a=t.match(o))&&a[1]&&(a=a[1]),a)for(a=a.split(/[._]+/),r=0;r<a.length;r+=1)0===r?a[r]+".":a[r];else"0";return e[n].name}return"Unknown"}};return t.init()},n.register=function(t,e,o){try{var r=new Date,i=r.toISOString().slice(0,10),s={shop_id:window.Pop.common.shop.id,name:t,params:e||{},timestamp:parseInt(r.getTime()),date:i,hour:r.getUTCHours(),id:v(),app:o};g((function(){a.cookies&&!n.getVisitId()&&x(),g((function(){n.log(s),s.visit_token=n.getVisitId(),s.visitor_token=n.getVisitorId(),_(s)}))}))}catch(t){n.log(t),n.log("error applying")}return!0},n.registerAppClicks=function(){n.onBaEv("click",".ba-met-handler",(function(t){try{var e=t.target,o=e.getAttribute("data-ba-met-name");if(o){var a=S(t),r=e.getAttribute("data-ba-met-app");if(a.text="input"==a.tag?e.value:(e.textContent||e.innerText||e.innerHTML).replace(/[\s\r\n]+/g," ").trim(),a.href=e.href,i=e.getAttribute("data-ba-met-extras")){var i=cleanNumbers(JSON.parse(i));for(var s in i)i.hasOwnProperty(s)&&(a[s]=i[s])}n.register(o,a,r)}}catch(t){n.log("applyAppClicks exception"),n.log(t)}}))},n.registerAtc=function(){n.onBaEv("click",".product-form__cart-submit, #AddToCart-product-template, .product-atc-btn, .product-menu-button.product-menu-button-atc, .button-cart, .product-add, .add-to-cart input, .btn-addtocart, [name=add]",(function(t){Date.now();var e=t.target,o=S(t);o.text="input"==o.tag?e.value:(e.textContent||e.innerText||e.innerHTML).replace(/[\s\r\n]+/g," ").trim(),o.href=e.href,n.register("atc",o,"ba")}))},n.saveBaCartData=function(t){if(s){var e=n.getBaCartData();e.push(t),localStorage.setItem("baMet_cartData",JSON.stringify(e))}},n.getBaCartData=function(){try{if(localStorage.getItem("baMet_cartData")){var t=parseInt((new Date).getTime())-2592e5,e=JSON.parse(localStorage.getItem("baMet_cartData")).filter((function(e){return parseInt(e.ts)>t})).reverse();return localStorage.setItem("baMet_cartData",JSON.stringify(e)),e}return[]}catch(t){n.log(t),n.log("error getting ba")}},n.updateBaCart=function(t){n.log("checking if cart is out of sync with db");var e=n.getCookie("cart"),o=n.getCookie("ba_cart_token"),r=localStorage.getItem("baMet_latest_cart"),i=localStorage.getItem("baMsg_synced_cart");0!=(t||r!=i||e!=o)?(n.setCookie("ba_cart_token",e,2880),a.bam||n.register("update_cart_db",{},"ba"),localStorage.setItem("baMsg_synced_cart",r),n.log("cart token changed -posting to the API from here")):n.log("cart is in sync with db")},n.setCartAttributes=function(t,e){try{if(n.log("setting cart attributes"),"string"==typeof e)var o=JSON.parse(e);else o=e;var a=n.getCookie("cart"),r=localStorage.getItem("baMet_latest_cart");if(!a&&!r)return;if(t){n.log("set cart attributes identified ajax cart update"),n.log(o);var i=m(a,o);window.Pop.common.cart=i}else f=a,window.Pop.common.cart=m(f,window.Pop.common.cart),i=window.Pop.common.cart;localStorage.setItem("baMet_latest_cart",JSON.stringify(i));var s=i.items,c=n.getBaCartData();if(c.length>0){var u={visit_token:n.getVisitId(),visitor_token:n.getVisitorToken(),items:[],cart_token:a};for(O=0;O<s.length;O++){var l=s[O];if(l){var g=c.find((function(t){return t.id==l.id}));g&&(l.ba_conversion_data=g,u.items.push(g),window.Pop.common.has_ba_conversion=!0)}}var d=JSON.stringify(u)}var p=localStorage.getItem("ba_conversion_data");window.Pop.common.ba_conversion_data=u,p!=d||window.Pop.common.ba_conversion_data&&"cart"==window.Pop.common.template?(n.log("saving ba_conversion_data"),localStorage.setItem("ba_conversion_data",d),n.updateBaCart(!0)):n.updateBaCart(!1)}catch(t){n.log("setCartAttributes exception"),n.log(t)}var f},n.registerAll=function(){document.referrer.indexOf("/admin/shops/")>0&&n.setCookie("ba_admin",1,1051200),n.setCartAttributes(!1,{}),n.registerAppClicks()};try{c=JSON.parse(n.getCookie("baMet_baEvs")||"[]")}catch(t){}for(var O=0;O<c.length;O++)w(c[O]);var P;return a.batc||(function(){n.log("awaiting ajax cart update");try{var t=XMLHttpRequest.prototype.open;XMLHttpRequest.prototype.open=function(){this.addEventListener("load",(function(){this._url&&this._url.search(/cart.*js/)>=0&&"GET"!=this._method&&(n.log("its a cart endpoint thats not a get request"),f(this))})),t.apply(this,arguments)}}catch(t){n.log(t),n.log("error catching ajax cart")}}(),function(){n.log("awaiting cart fetch update");try{var t=fetch;fetch=function(e,o){var a=!1;e&&"function"==typeof e.search&&e.search(/cart.*js|cart\/add|cart\/change/)>=0&&e.search("ba_request")<0&&o&&("POST"==o.method||"PUT"==o.method)&&(n.log("caught a fetch cart event",e,o),a=!0);var r=t(e,o);return r.then((function(t){a&&n.getCartData((function(t){n.setCartAttributes(!0,t)}))})),r}}catch(t){n.log(t),n.log("error catching cart fetch")}}()),n.start=function(){var t;a.bam&&n.log("SESSIONS ARE RATE LIMITED - THE APP WILL NOT WORK UNTIL 00:00 UTC"),x(),n.start=function(){},a.page_views&&(t=n.page_hash,n.register("page_view",t,"ba")),window.Pop.common.customer&&!n.getCustomerId()&&(n.register("sync_customer",{},"ba"),localStorage.setItem("baMet_customer_id",window.Pop.common.customer.id))},P=function(){a.startOnReady&&n.start()},"interactive"===document.readyState||"complete"===document.readyState?P():document.addEventListener("DOMContentLoaded",P),n.page_hash={url:window.location.href,page:y(),template:window.Pop.common.template},n.registerAll(),n}()}();
//# sourceMappingURL=https://marketing.rivo.io/assets/storefront/ba_pop_tracking.js-b6aaa8189bae786950b10f68c6363f37beb6206d34dc693070c8abd24f17faea.map
//!

;
